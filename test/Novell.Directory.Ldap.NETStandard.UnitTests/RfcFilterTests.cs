using Novell.Directory.Ldap.Rfc2251;
using Xunit;

namespace Novell.Directory.Ldap.NETStandard.UnitTests
{
    public class RfcFilterTests
    {
        [Theory]
        [InlineData("(&(objectCategory=person)(objectClass=user))")]
        [InlineData("(sAMAccountType=805306368)")]
        [InlineData("(objectCategory=computer)")]
        [InlineData("(objectClass=contact)")]
        [InlineData("(objectCategory=group)")]
        [InlineData("(objectCategory=organizationalUnit)")]
        [InlineData("(objectCategory=container)")]
        [InlineData("(objectCategory=builtinDomain)")]
        [InlineData("(objectCategory=domain)")]
        [InlineData("(&(objectCategory=computer)(!(description=*)))")]
        [InlineData("(&(objectCategory=group)(description=*))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(cn=Joe*))")]
        [InlineData("(&(objectCategory=group)(|(cn=Test*)(cn=Admin*)))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(givenName=*)(sn=*))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(directReports=*)(!(manager=*)))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(scriptPath=*))")]
        [InlineData("(sAMAccountName>=x)")]
        [InlineData("(&(sAMAccountName<=a)(!(sAMAccountName=$*)))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=65536))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=2))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=32))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=4194304))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(|(accountExpires=0)(accountExpires=9223372036854775807)))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(accountExpires>=1)(accountExpires<=9223372036854775806))")]
        [InlineData("(userAccountControl:1.2.840.113556.1.4.803:=524288)")]
        [InlineData("(userAccountControl:1.2.840.113556.1.4.803:=1048576)")]
        [InlineData("(&(objectCategory=group)(!(groupType:1.2.840.113556.1.4.803:=2147483648)))")]
        [InlineData("(groupType:1.2.840.113556.1.4.803:=2147483648)")]
        [InlineData("(groupType:1.2.840.113556.1.4.803:=1)")]
        [InlineData("(groupType:1.2.840.113556.1.4.803:=2)")]
        [InlineData("(groupType:1.2.840.113556.1.4.803:=4)")]
        [InlineData("(groupType:1.2.840.113556.1.4.803:=8)")]
        [InlineData("(groupType=-2147483646)")]
        [InlineData("(groupType=-2147483640)")]
        [InlineData("(groupType=-2147483644)")]
        [InlineData("(groupType=2)")]
        [InlineData("(servicePrincipalName=*)")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(msNPAllowDialin=TRUE))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(!(msNPAllowDialin=*)))")]
        [InlineData("(&(objectCategory=group)(whenCreated>=20110301000000.0Z))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(pwdLastSet=0))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(pwdLastSet>=129473172000000000))")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(!(primaryGroupID=513)))")]
        [InlineData("(&(objectCategory=computer)(primaryGroupID=515))")]
        [InlineData("(objectSID=S-1-5-21-73586283-152049171-839522115-1111)")]
        [InlineData("(&(objectCategory=computer)(!(userAccountControl:1.2.840.113556.1.4.803:=8192)))")]
        [InlineData("(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))")]
        [InlineData("(primaryGroupID=516)")]
        [InlineData("(memberOf=cn=Test,ou=East,dc=Domain,dc=com)")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(!(memberOf=cn=Test,ou=East,dc=Domain,dc=com)))")]
        [InlineData("(member=cn=Jim Smith,ou=West, dc=Domain,dc=com)")]
        [InlineData("(memberOf:1.2.840.113556.1.4.1941:= cn=Test,ou=East,dc=Domain,dc=com)")]
        [InlineData("(member:1.2.840.113556.1.4.1941:= cn=Jim Smith,ou=West,dc=Domain,dc=com)")]
        [InlineData("(anr=Jim Smith)")]
        [InlineData("(&(objectCategory=attributeSchema)(isMemberOfPartialAttributeSet=TRUE))")]
        [InlineData("(&(objectCategory=attributeSchema)(systemFlags:1.2.840.113556.1.4.803:=4))")]
        [InlineData("(&(objectCategory=attributeSchema)(systemFlags:1.2.840.113556.1.4.803:=1))")]
        [InlineData("(systemFlags:1.2.840.113556.1.4.803:=2147483648)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=16)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=8)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=4)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=1)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=128)")]
        [InlineData("(searchFlags:1.2.840.113556.1.4.803:=512)")]
        [InlineData("(objectClass=siteLink)")]
        [InlineData("(objectClass=nTDSConnection)")]
        [InlineData("(&(objectCategory=nTDSDSA)(options:1.2.840.113556.1.4.803:=1))")]
        [InlineData("(&(objectClass=domainDNS)(fSMORoleOwner=*))")]
        [InlineData("(&(objectClass=rIDManager)(fSMORoleOwner=*))")]
        [InlineData("(&(objectClass=infrastructureUpdate)(fSMORoleOwner=*))")]
        [InlineData("(&(objectClass=dMD)(fSMORoleOwner=*))")]
        [InlineData("(&(objectClass=crossRefContainer)(fSMORoleOwner=*))")]
        [InlineData("(objectCategory=msExchExchangeServer)")]
        [InlineData("(adminCount=1)")]
        [InlineData("(objectClass=trustedDomain)")]
        [InlineData("(objectCategory=groupPolicyContainer)")]
        [InlineData("(objectClass=serviceConnectionPoint)")]
        [InlineData("(userAccountControl:1.2.840.113556.1.4.803:=67108864)")]
        [InlineData("(sAMAccountName=user🐉👽✨)")]

        [InlineData("(description=East\\5CWest Sales)", Skip="Not equals")]
        [InlineData("(cn=Jim \\2A Smith)", Skip = "Not equals")]

        [InlineData("(telephoneNumber=(*)*-*)", Skip = "Parse fails")]
        [InlineData(@"(objectGUID=\90\39\5F\19\1A\B5\1B\4A\9E\96\86\C6\6C\B1\8D\11)", Skip = "Not equals escaping")]
        [InlineData(@"(objectGUID=\90\39\5F\19\1A\B5\1B\4A*)", Skip = "Not equals escaping")]
        [InlineData(@"(objectSID=\01\05\00\00\00\00\00\05\15\00\00\00\6b\d6\62\04\13\16\10\09\43\17\0a\32\57\04\00\00)", Skip = "Not equals escaping")]
        [InlineData("(&(objectCategory=computer)(operatingSystem=*server*))", Skip = "Not equals mask")]
        [InlineData("(&(objectCategory=computer)(operatingSystem=*server*)(!(userAccountControl:1.2.840.113556.1.4.803:=8192)))", Skip = "Not equals mask")]
        [InlineData("(&(objectCategory=person)(objectClass=user)(|(proxyAddresses=*:jsmith@company.com)(mail=jsmith@company.com)))", Skip = "Not equals mask")]

        public void RfcFilter_Test(string filterString)
        {
            var filter = new RfcFilter(filterString);

            Assert.Equal(filterString, filter.FilterToString());
        }
    }
}
